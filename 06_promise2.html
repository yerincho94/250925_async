<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promise</title>
  </head>
  <body>
    <script>
      console.log("A"); //script
      setTimeout(() => {
        console.log("T");
      }, 0); //setTimeout을 통해서 매크로태스크에 보냄
      Promise.resolve().then(() => console.log("P")); //마이크로태스크큐
      console.log("B");
      //script가 모두 실행이 되고, 중간에 마이크로태스크큐를 모두 실행하고, 다음 macrotask queue인 setTimeout이 실행

      //실행 순서 : 1. script > 2. Promise > 3. setTimeout

      function delay(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      //Promise - Pending:대기 상태
      //Resolve -> Fulfilled 상태 (정상작업) : then으로 연결
      //Reject -> Rejected인 상태 : catch로 연결

      //then/catch있으면 --> Promise임
      const a = delay(1000).then(() => {
        console.log("a 실행 완료");
        throw new Error("a 실패");
        return "a";
      });
      const b = delay(500).then(() => {
        console.log("b 실행 완료");
        throw new Error("b 실패");
        return "b";
      });
      const c = delay(2000).then(() => {
        console.log("c 실행 완료");
        return "c";
      });

      //resolve, reject
      //여러곳에서 조합해서 하나의 결과를 만들어야 하는데....

      //(return값) -> console.log에 패러미터로 직접 받은 것.
      Promise.all([a, b, c])
        .then(console.log) //전체 성공해야 여기
        .catch(console.error); //실패시 여기로 처리 됨.

      //어떠한 기록을 남기거나 관리를 위해서...
      Promise.allSettled([a, b, c])
        .then(console.log) //여기까지 무조건 실행
        .catch(console.error); //allSettled에 대한 then이 실패하는 것에 대한 catch

      //동일한 결과가 나오는 서버와 출저를 접근하는 것이라면....
      //가장 먼저 확정된것을 하나만 결과로 가져오는 것.
      Promise.race([a, b, c])
        .then((v) => console.log("race: ", v)) //맨 먼저 실패하면 그것을 반영
        //settle -> 맨 먼저 결과가 확정된 것을 따라가는 것
        .catch(console.error);

      //동일한 결과가 나오지 않을 수 있는....
      //ex) A서버가 끊겨있더라도 B,C 서버라도 계속 찾는....
      Promise.any([a, b, c])
        .then((v) => console.log("any: ", v)) //하나라도 성공하면 성공하는것
        .catch(console.error);

      // 보통 all, any를 많이 씀
      /* 
        버스 api -> 버스 노선도, 버스 선호도, 버스 가격표 -> 데이터 추출
        하나라도 없으면 이상함 그때-> all 로 사용해서 데이터를 요청

        any -> AWS, GCP, Azure 3중화 일때. 
    */
    </script>
  </body>
</html>
